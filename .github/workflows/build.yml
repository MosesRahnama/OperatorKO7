name: build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  release:
    types: [published]

jobs:
  lake-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Install elan (Lean toolchain manager)
        run: |
          curl -sSfL https://raw.githubusercontent.com/leanprover/elan/master/elan-init.sh | sh -s -- -y
          echo "$HOME/.elan/bin" >> $GITHUB_PATH
          
      - name: Verify Lean installation
        run: |
          lean --version
          lake --version
          
      - name: Fetch mathlib cache (optional but recommended)
        run: lake exe cache get || echo "Cache fetch failed; will build from source"
        
      - name: Build OperatorKO7
        run: lake build
        
      - name: Verify build artifacts
        run: |
          echo "Build completed successfully"
          find .lake/build -name "*.olean" | head -n 10
